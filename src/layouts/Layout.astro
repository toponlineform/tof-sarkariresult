---
// src/layouts/Layout.astro
import MarketingPopup from '../components/MarketingPopup.astro';

// ‚úÖ IMPORT ADSENSE SETTINGS (Centralized Control)
import { ADSENSE_ID, LOAD_SCRIPT } from '../components/AdSlot.astro';

// ‚úÖ IMPORT NEW LOGO COMPONENT
import LogoWithText from '../components/LogoWithText.astro';

const { 
  title, 
  description, 
  isPost = false,
  image = "/og-default.jpg" // Default Social Image
} = Astro.props;

const siteUrl = "https://toponlineform.com";
const canonicalURL = new URL(Astro.url.pathname, siteUrl);

// --- üöÄ INFINITY SEO TITLE LOGIC ---
let seoTitle = title;
let seoDescription = description;

const currentPath = Astro.url.pathname;

if (currentPath === "/" || currentPath === "") {
  seoTitle = "Top Online Form: Sarkari Result, Latest Govt Jobs & Admit Card 2026";
  seoDescription = "India's No.1 Portal for Sarkari Result, Latest Government Jobs, Admit Cards, and Results updates at TopOnlineForm.com.";
} 
else if (isPost && !title.toLowerCase().includes('form')) {
  seoTitle = `${title} 2026 Online Form | Eligibility, Last Date - Top Online Form`;
} 
else if (!isPost) {
  seoTitle = title.includes("Top Online Form") ? title : `${title} - Top Online Form`;
}

// üß† BRAND SCHEMA (ORGANIZATION)
const organizationSchema = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Top Online Form",
  "url": siteUrl,
  "logo": `${siteUrl}/logo.png`,
  "sameAs": [
    "https://facebook.com/toponlineform",
    "https://twitter.com/toponlineform",
    "https://instagram.com/toponlineform"
  ],
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "customer support",
    "email": "support@toponlineform.com"
  }
});
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    {/* Optimized Viewport for Mobile Responsiveness & Accessibility */}
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
    
    <title>{seoTitle}</title>
    <meta name="title" content={seoTitle} />
    <meta name="description" content={seoDescription} />
    
    <link rel="canonical" href={canonicalURL} />
    <meta name="robots" content="index, follow" />
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <link rel="sitemap" href="/sitemap-index.xml" />
    
    {/* SOCIAL META TAGS (Open Graph) */}
    <meta property="og:type" content={isPost ? "article" : "website"} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={seoTitle} />
    <meta property="og:description" content={seoDescription} />
    <meta property="og:image" content={new URL(image, siteUrl)} />
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={seoTitle} />
    <meta property="twitter:description" content={seoDescription} />
    <meta property="twitter:image" content={new URL(image, siteUrl)} />

    {/* üèÜ BRAND SCHEMA INJECTION */}
    <script type="application/ld+json" set:html={organizationSchema} />

    {/* üí∞ GOOGLE ADSENSE (Controlled by AdSlot Switch) */}
    {LOAD_SCRIPT && (
        <script async src={`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${ADSENSE_ID}`}
         crossorigin="anonymous"></script>
    )}

    {/* Tailwind CSS */}
    <script is:inline src="https://cdn.tailwindcss.com"></script>
    
    {/* Search Scripts */}
    <link href="/pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/pagefind/pagefind-ui.js" is:inline></script>

    <slot name="head" />

    <style>
        #searchOverlay.open { display: flex; }
        /* Pagefind Tweaks */
        :root {
            --pagefind-ui-scale: 0.9;
            --pagefind-ui-primary: #b91c1c;
            --pagefind-ui-text: #1f2937;
            --pagefind-ui-background: #ffffff;
            --pagefind-ui-border: #e5e7eb;
            --pagefind-ui-border-radius: 0.5rem;
        }
        .pagefind-ui__result {
            padding: 10px 0 !important;
            border-bottom: 1px solid #eee !important;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen font-sans">

    {/* HEADER */}
    <header class="bg-red-700 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3">
            
            {/* Top Bar: Logo & Mobile Toggle */}
            <div class="flex justify-between items-center">
                
                {/* ‚úÖ UPDATED LOGO SECTION (Live Animated) */}
                <a href="/" class="flex items-center text-2xl md:text-3xl font-extrabold uppercase tracking-tighter hover:opacity-90 transition" title="Top Online Form Home">
                    <LogoWithText />
                </a>

                {/* Mobile Controls */}
                <div class="flex items-center gap-4 md:hidden">
                    <button id="mobileSearchToggle" class="hover:text-yellow-300 focus:outline-none" aria-label="Search">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                    <button id="mobileMenuBtn" class="hover:text-yellow-300 focus:outline-none" aria-label="Menu">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                </div>

                {/* Desktop Navigation */}
                <nav class="hidden md:flex flex-wrap justify-center items-center gap-6 font-semibold text-sm uppercase tracking-wide">
                    <a href="/" class="hover:text-yellow-300 transition">Home</a>
                    <a href="/active-jobs" class="hover:text-yellow-300 transition text-yellow-100 font-bold">Active Jobs</a>
                    <a href="/latest-jobs" class="hover:text-yellow-300 transition">Latest Jobs</a>
                    <a href="/admit-card" class="hover:text-yellow-300 transition">Admit Card</a>
                    <a href="/results" class="hover:text-yellow-300 transition">Results</a>
                    <a href="/answer-key" class="hover:text-yellow-300 transition">Answer Key</a>
                    
                    <a href="/tools" class="flex items-center gap-1 hover:text-yellow-300 transition text-yellow-100 font-bold">
                        Tools
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mb-0.5" viewBox="0 0 24 24" fill="currentColor">
                            <path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5zM2.25 10.5a8.25 8.25 0 1114.59 5.28l4.69 4.69a.75.75 0 11-1.06 1.06l-4.69-4.69A8.25 8.25 0 012.25 10.5zm8.25-3.75a.75.75 0 00.75.75v.01c1.55.03 2.97.97 3.47 2.45a.75.75 0 101.42-.48 5.26 5.26 0 00-4.89-3.48v.01a.75.75 0 00-.75.74z" clip-rule="evenodd" />
                            <path d="M19.646 2.646a.5.5 0 01.708 0l1 1a.5.5 0 010 .708l-1.5 1.5-1.708-1.708 1.5-1.5zM17.439 5.854l1.708 1.708-8.5 8.5a.5.5 0 01-.166.11l-3 1a.5.5 0 01-.632-.633l1-3a.5.5 0 01.11-.166l8.48-8.52z"/>
                        </svg>
                    </a>

                    {/* Desktop Dropdown */}
                    <div class="relative group">
                        <button class="flex items-center gap-1 hover:text-yellow-300 transition focus:outline-none font-semibold text-sm uppercase tracking-wide">
                            More <span>‚ñæ</span>
                        </button>
                        <div class="absolute right-0 mt-2 w-48 bg-white text-gray-800 rounded-md shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform origin-top-right z-50 border border-gray-200 text-left overflow-hidden">
                            <a href="/state-wise-jobs" class="block px-4 py-3 hover:bg-blue-50 border-b border-gray-100 transition hover:text-blue-700">üåç State Wise Jobs</a>
                            <a href="/admission" class="block px-4 py-3 hover:bg-blue-50 border-b border-gray-100 transition hover:text-blue-700">üéì Admission</a>
                            <a href="/syllabus" class="block px-4 py-3 hover:bg-blue-50 transition hover:text-blue-700">üìñ Syllabus</a>
                        </div>
                    </div>

                    <button id="desktopSearchToggle" class="hover:text-yellow-300 transition focus:outline-none" aria-label="Search">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                </nav>
            </div>

            {/* Mobile Menu Dropdown */}
            <div id="mobileMenu" class="hidden md:hidden mt-3 border-t border-red-500 pt-3">
                <nav class="flex flex-col space-y-3 font-semibold text-sm uppercase tracking-wide">
                    <a href="/" class="hover:text-yellow-300 block">Home</a>
                    <a href="/active-jobs" class="hover:text-yellow-300 block text-yellow-100 font-bold">Active Jobs</a>
                    <a href="/latest-jobs" class="hover:text-yellow-300 block">Latest Jobs</a>
                    <a href="/admit-card" class="hover:text-yellow-300 block">Admit Card</a>
                    <a href="/results" class="hover:text-yellow-300 block">Results</a>
                    <a href="/answer-key" class="hover:text-yellow-300 block">Answer Key</a>
                    <a href="/tools" class="hover:text-yellow-300 block text-yellow-100 font-bold">Tools</a>
                    <a href="/state-wise-jobs" class="hover:text-yellow-300 block">üåç State Wise Jobs</a>
                    <a href="/admission" class="hover:text-yellow-300 block">üéì Admission</a>
                    <a href="/syllabus" class="hover:text-yellow-300 block">üìñ Syllabus</a>
                </nav>
            </div>

        </div>
    </header>

    {/* SEARCH OVERLAY */}
    <div id="searchOverlay" class="fixed inset-0 bg-black/80 z-[60] hidden justify-center items-start pt-10 px-4 backdrop-blur-sm transition-all">
        <div class="bg-white w-full max-w-2xl rounded-lg shadow-2xl relative p-6 max-h-[85vh] overflow-y-auto">
            <button id="closeSearch" class="absolute top-2 right-2 text-gray-500 hover:text-red-600 bg-gray-100 rounded-full p-1" aria-label="Close Search">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h3 class="text-gray-800 font-bold text-lg mb-4 border-b pb-2">Search Top Online Form</h3>
            <div id="search" class="min-h-[100px]"></div>
        </div>
    </div>

    {/* MAIN CONTENT */}
    <main class="flex-grow w-full max-w-7xl mx-auto p-3 md:p-6">
        <slot />
    </main>

    {/* FOOTER */}
    <footer class="bg-gray-900 text-white py-8 mt-auto border-t-4 border-red-700">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h2 class="text-xl font-bold mb-2">TopOnlineForm.com</h2>
            <p class="text-gray-400 text-sm mb-4">India's No.1 Portal for Sarkari Result, Latest Govt Jobs, and Admit Cards.</p>
            <div class="flex justify-center flex-wrap gap-4 text-xs text-gray-500 mb-4">
                <a href="/about" class="hover:text-white transition-colors">About Us</a>
                <a href="/contact" class="hover:text-white transition-colors">Contact Us</a>
                <a href="/disclaimer" class="hover:text-white transition-colors">Disclaimer</a>
                <a href="/privacy-policy" class="hover:text-white transition-colors">Privacy Policy</a>
                <a href="/terms-conditions" class="hover:text-white transition-colors font-bold text-gray-400">Terms & Conditions</a>
                <a href="/sitemap-index.xml" class="hover:text-white transition-colors">Sitemap</a>
            </div>
            <p class="text-xs text-gray-600">Copyright ¬© 2026 TopOnlineForm. All Rights Reserved.</p>
        </div>
    </footer>

    <MarketingPopup />

    {/* SCRIPTS */}
    <script is:inline>
        // ELEMENTS
        const desktopSearchToggle = document.getElementById('desktopSearchToggle');
        const mobileSearchToggle = document.getElementById('mobileSearchToggle');
        const searchOverlay = document.getElementById('searchOverlay');
        const closeSearch = document.getElementById('closeSearch');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');

        // FUNCTIONS
        function openSearch() {
            searchOverlay.classList.remove('hidden');
            searchOverlay.classList.add('flex');
            setTimeout(() => {
                const input = document.querySelector('.pagefind-ui__search-input');
                if(input) input.focus();
            }, 200);
        }

        function closeSearchFunc() {
            searchOverlay.classList.add('hidden');
            searchOverlay.classList.remove('flex');
        }

        // LISTENERS
        if(desktopSearchToggle) desktopSearchToggle.addEventListener('click', openSearch);
        if(mobileSearchToggle) mobileSearchToggle.addEventListener('click', openSearch);
        if(closeSearch) closeSearch.addEventListener('click', closeSearchFunc);

        // Search Overlay Click Outside
        searchOverlay.addEventListener('click', (e) => {
            if (e.target === searchOverlay) {
                closeSearchFunc();
            }
        });

        // Mobile Menu Toggle
        if(mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
        }

        // Initialize Pagefind
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ 
                element: "#search", 
                showSubResults: true,
                showImages: false 
            });
        });
    </script>
</body>
</html>

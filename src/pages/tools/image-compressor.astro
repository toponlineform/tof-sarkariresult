---
import ToolLayout from '../../layouts/ToolLayout.astro';
import AdSlot from '../../components/AdSlot.astro';

const title = "Image Compressor to 20kb, 50kb, 100kb - Reduce Photo Size Online";
const description = "Free Online Image Compressor. Reduce JPG/PNG size to under 20KB, 50KB, or 100KB for SSC, UPSC, and IBPS Application Forms. Maintain quality.";
---

<ToolLayout 
  title={title} 
  description={description}
  toolName="Image Compressor"
>

  {/* ‚ö° FAQ SCHEMA (Targeting "How to reduce size") */}
  <script type="application/ld+json" slot="head">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "How to compress image to 20kb for SSC?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Upload your photo in our Infinity Image Compressor, select the 'Extreme (20KB)' preset or adjust the slider until the size shows under 20KB. Download and upload to the SSC portal."
        }
      }, {
        "@type": "Question",
        "name": "Does reducing image size reduce quality?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Our smart compression algorithm removes unnecessary metadata and optimizes pixels so the file size drops significantly (e.g., 2MB to 50KB) while the photo looks clear to the human eye."
        }
      }]
    }
  </script>

  {/* üü¢ TOP AD */}
  <div class="mb-6">
    <AdSlot type="horizontal" />
  </div>

  {/* MAIN TOOL CONTAINER */}
  <div class="space-y-8">
      
      {/* STEP 1: UPLOAD AREA */}
      <div id="uploadArea" class="text-center transition-all duration-300">
          <div class="border-4 border-dashed border-green-200 bg-green-50 rounded-2xl p-10 hover:bg-green-100 transition cursor-pointer max-w-2xl mx-auto group relative overflow-hidden" onclick="document.getElementById('fileInput').click()">
              {/* Background Icon Decoration */}
              <div class="absolute -right-10 -bottom-10 text-9xl opacity-10 rotate-12">üìâ</div>
              
              <div class="relative z-10">
                <div class="text-6xl mb-4 group-hover:scale-110 transition transform duration-200">üìÇ</div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Select Image to Compress</h3>
                <p class="text-gray-500 font-medium">Supports JPG, PNG, JPEG</p>
                <div class="mt-6 inline-block bg-green-600 text-white px-6 py-2 rounded-full font-bold shadow-md group-hover:shadow-lg transition">
                    Choose File
                </div>
              </div>
              <input type="file" id="fileInput" accept="image/*" class="hidden" />
          </div>
          
          {/* Quick Info Tags */}
          <div class="mt-6 flex justify-center gap-3 flex-wrap">
             <span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs font-bold border border-gray-200">üéØ Target 20KB</span>
             <span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs font-bold border border-gray-200">üéØ Target 50KB</span>
             <span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs font-bold border border-gray-200">üîí 100% Secure</span>
          </div>
      </div>

      {/* STEP 2: COMPRESSOR INTERFACE (Hidden Initially) */}
      <div id="compressArea" class="hidden animate-fade-in">
          
          <div class="flex flex-col gap-8">
              
              {/* 1. PREVIEW & STATS CARD */}
              <div class="bg-white rounded-xl border border-gray-200 shadow-lg overflow-hidden flex flex-col md:flex-row">
                  
                  {/* Left: Image Preview */}
                  <div class="w-full md:w-1/2 bg-gray-100 p-6 flex items-center justify-center relative">
                      <div class="relative shadow-md rounded-lg overflow-hidden border border-gray-300 bg-[url('https://res.cloudinary.com/dvp2139/image/upload/v1700000000/transparent-bg.png')]"> 
                         {/* Default transparent pattern bg if available, else gray */}
                         <img id="previewImage" class="max-w-full max-h-[300px] object-contain" />
                      </div>
                      <div class="absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-1 rounded backdrop-blur-sm">Live Preview</div>
                  </div>

                  {/* Right: Size Comparison */}
                  <div class="w-full md:w-1/2 p-6 flex flex-col justify-center space-y-6">
                      <div class="grid grid-cols-2 gap-4">
                          <div class="bg-red-50 p-3 rounded-lg border border-red-100 text-center">
                              <span class="block text-gray-500 text-xs uppercase font-bold tracking-wider">Original</span>
                              <strong id="originalSize" class="text-red-600 text-xl md:text-2xl font-mono">0 KB</strong>
                          </div>
                          <div class="bg-green-50 p-3 rounded-lg border border-green-100 text-center relative">
                              <div class="absolute -top-3 -right-3 bg-green-600 text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-sm animate-pulse">NEW</div>
                              <span class="block text-gray-500 text-xs uppercase font-bold tracking-wider">Compressed</span>
                              <strong id="compressedSize" class="text-green-600 text-xl md:text-2xl font-mono">0 KB</strong>
                          </div>
                      </div>
                      
                      <div class="text-center">
                          <p id="savingsText" class="text-sm text-gray-500 font-medium">Reduced by <span class="text-green-600 font-bold">0%</span></p>
                      </div>
                  </div>
              </div>

              {/* 2. CONTROLS AREA */}
              <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-md">
                  
                  <div class="flex justify-between items-center mb-4">
                     <h3 class="font-bold text-gray-800 flex items-center gap-2">
                        <span>üéöÔ∏è</span> Quality Level
                     </h3>
                     <span id="qualityValue" class="text-sm font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded">80%</span>
                  </div>

                  {/* Slider */}
                  <input type="range" id="qualitySlider" min="1" max="100" value="80" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-600 hover:accent-green-700 transition-all mb-6">

                  {/* Quick Presets (The Magic Buttons for SEO) */}
                  <label class="block text-xs font-bold text-gray-400 uppercase tracking-wide mb-2">Quick Presets (Govt Job Specials)</label>
                  <div class="grid grid-cols-3 gap-3 mb-6">
                      <button data-q="90" class="preset-btn text-xs bg-gray-50 border border-gray-200 hover:border-green-500 hover:bg-green-50 py-3 rounded-lg text-gray-700 font-medium transition flex flex-col items-center gap-1">
                          <span>Low Compression</span>
                          <span class="text-[10px] text-gray-400">High Quality</span>
                      </button>
                      <button data-q="50" class="preset-btn text-xs bg-gray-50 border border-gray-200 hover:border-green-500 hover:bg-green-50 py-3 rounded-lg text-gray-700 font-medium transition flex flex-col items-center gap-1">
                          <span>Medium (50KB)</span>
                          <span class="text-[10px] text-gray-400">Balanced</span>
                      </button>
                      <button data-q="15" class="preset-btn text-xs bg-gray-50 border border-gray-200 hover:border-green-500 hover:bg-green-50 py-3 rounded-lg text-gray-700 font-medium transition flex flex-col items-center gap-1">
                          <span>Extreme (20KB)</span>
                          <span class="text-[10px] text-gray-400">Max Reduce</span>
                      </button>
                  </div>

                  {/* Actions */}
                  <div class="flex flex-col sm:flex-row gap-4">
                      <button id="downloadBtn" class="flex-1 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition transform hover:-translate-y-1 flex justify-center items-center gap-2">
                          Download Image ‚¨áÔ∏è
                      </button>
                      <button onclick="location.reload()" class="sm:w-auto w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-3 px-6 rounded-xl transition">
                          Reset üîÑ
                      </button>
                  </div>
              </div>

          </div>
      </div>
  </div>

  {/* SEO CONTENT SLOT (Targeting "SSC Photo Size") */}
  <div slot="content">
      <p class="lead text-lg text-gray-700 mb-6">
          Reducing image size is a crucial step when applying for online government jobs. High-quality phone cameras often take photos of 2MB-5MB, but portals like <strong>SSC, UPSC, and OJAS</strong> accept files only under 20KB or 50KB.
      </p>

      <h3>Common Image Size Requirements 2025</h3>
      <div class="overflow-x-auto mb-6">
        <table class="min-w-full text-sm text-left border rounded-lg overflow-hidden">
          <thead class="bg-green-50 text-green-800 font-bold">
            <tr>
              <th class="p-3 border-b">Exam / Board</th>
              <th class="p-3 border-b">Document Type</th>
              <th class="p-3 border-b">Required Size</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            <tr><td class="p-3">SSC (CGL, CHSL, GD)</td><td class="p-3">Photograph</td><td class="p-3 font-bold text-green-700">20KB - 50KB</td></tr>
            <tr><td class="p-3">SSC (CGL, CHSL, GD)</td><td class="p-3">Signature</td><td class="p-3 font-bold text-green-700">10KB - 20KB</td></tr>
            <tr><td class="p-3">UPSC (IAS, IPS)</td><td class="p-3">Photo & Sign</td><td class="p-3 font-bold text-green-700">20KB - 300KB</td></tr>
            <tr><td class="p-3">IBPS (Bank PO/Clerk)</td><td class="p-3">Photograph</td><td class="p-3 font-bold text-green-700">20KB - 50KB</td></tr>
            <tr><td class="p-3">Indian Railways (RRB)</td><td class="p-3">Photograph</td><td class="p-3 font-bold text-green-700">30KB - 70KB</td></tr>
          </tbody>
        </table>
      </div>

      <h3>How to reduce image size to 20KB?</h3>
      <ol class="list-decimal pl-5 space-y-2">
          <li>Click on <strong>"Select Image"</strong> and upload your photo.</li>
          <li>Click the <strong>"Extreme (20KB)"</strong> preset button.</li>
          <li>If the size is still high, lower the quality slider manually until you see the Green Text showing under 20KB.</li>
          <li>Click <strong>Download</strong>.</li>
      </ol>
  </div>

</ToolLayout>

{/* üß† JAVASCRIPT LOGIC */}
<script>
  const fileInput = document.getElementById('fileInput');
  const uploadArea = document.getElementById('uploadArea');
  const compressArea = document.getElementById('compressArea');
  const previewImage = document.getElementById('previewImage') as HTMLImageElement;
  const originalSizeSpan = document.getElementById('originalSize');
  const compressedSizeSpan = document.getElementById('compressedSize');
  const savingsText = document.getElementById('savingsText');
  const qualitySlider = document.getElementById('qualitySlider') as HTMLInputElement;
  const qualityValue = document.getElementById('qualityValue');
  const downloadBtn = document.getElementById('downloadBtn');
  const presetBtns = document.querySelectorAll('.preset-btn');

  let originalFile = null;
  let compressedBlob = null;

  // 1. Handle File Upload
  fileInput?.addEventListener('change', (e) => {
      // @ts-ignore
      if (e.target.files && e.target.files.length > 0) {
          // @ts-ignore
          originalFile = e.target.files[0];
          
          // Show UI
          uploadArea?.classList.add('hidden');
          compressArea?.classList.remove('hidden');

          // Display Original Size
          if(originalSizeSpan) originalSizeSpan.innerText = formatBytes(originalFile.size);

          // Initialize Compressor
          compressImage(0.8); // Default 80%
      }
  });

  // 2. Compress Logic (Using Canvas)
  function compressImage(quality) {
      if(!originalFile) return;

      const reader = new FileReader();
      reader.readAsDataURL(originalFile);
      reader.onload = (event) => {
          const img = new Image();
          // @ts-ignore
          img.src = event.target.result;
          
          img.onload = () => {
              const canvas = document.createElement('canvas');
              canvas.width = img.width;
              canvas.height = img.height;
              
              const ctx = canvas.getContext('2d');
              if(ctx) ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

              // Compress to specific quality (0 to 1)
              canvas.toBlob((blob) => {
                  compressedBlob = blob;
                  
                  if(blob) {
                      // Update Preview
                      previewImage.src = URL.createObjectURL(blob);
                      
                      // Update Stats
                      if(compressedSizeSpan) {
                         compressedSizeSpan.innerText = formatBytes(blob.size);
                         // Color Coding
                         if(blob.size < 20480) compressedSizeSpan.className = 'text-green-600 text-xl md:text-2xl font-mono'; // < 20KB
                         else if(blob.size < 51200) compressedSizeSpan.className = 'text-blue-600 text-xl md:text-2xl font-mono'; // < 50KB
                         else compressedSizeSpan.className = 'text-orange-600 text-xl md:text-2xl font-mono';
                      }

                      // Update Savings %
                      if(savingsText) {
                         const saving = ((originalFile.size - blob.size) / originalFile.size) * 100;
                         savingsText.innerHTML = `Reduced by <span class="text-green-600 font-bold">${Math.max(0, saving.toFixed(1))}%</span>`;
                      }
                  }

              }, 'image/jpeg', quality);
          };
      };
  }

  // 3. Slider Listener
  qualitySlider?.addEventListener('input', (e) => {
      // @ts-ignore
      const val = e.target.value;
      if(qualityValue) qualityValue.innerText = val + '%';
      const qualityDecimal = val / 100;
      compressImage(qualityDecimal);
  });

  // 4. Presets Listener
  presetBtns.forEach(btn => {
     btn.addEventListener('click', (e) => {
         // @ts-ignore
         const q = btn.getAttribute('data-q');
         if(qualitySlider) qualitySlider.value = q;
         if(qualityValue) qualityValue.innerText = q + '%';
         compressImage(parseInt(q) / 100);
     });
  });

  // 5. Download
  downloadBtn?.addEventListener('click', () => {
      if(!compressedBlob) return;
      const link = document.createElement('a');
      link.href = URL.createObjectURL(compressedBlob);
      link.download = `Compressed-${originalFile.name.split('.')[0]}.jpg`;
      link.click();
  });

  // Helper: Format Bytes
  function formatBytes(bytes, decimals = 2) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const dm = decimals < 0 ? 0 : decimals;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
  }
</script>

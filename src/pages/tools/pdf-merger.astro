---
import ToolLayout from '../../layouts/ToolLayout.astro';
import AdSlot from '../../components/AdSlot.astro';

// üéØ CHANGE 1: Title & Desc ab "Universal" hain (Sabke liye)
const title = "PDF Merger - Merge PDF Files Online for Free (Fast & Secure)";
const description = "Best Free PDF Merger. Combine multiple PDF files into one document instantly. No Upload Limit, No Watermark. Secure Client-side PDF Combiner.";
---

<ToolLayout 
  title={title} 
  description={description}
  toolName="PDF Merger"
>

  {/* ‚ö° FAQ SCHEMA (Broad Keywords: Combine, Join, Merge) */}
  <script type="application/ld+json" slot="head">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "How to merge PDF files online for free?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "1. Select your PDF files.\n2. Arrange them in the desired order.\n3. Click 'Merge PDF Now'.\n4. Download your combined file instantly."
        }
      }, {
        "@type": "Question",
        "name": "Is it safe to use Infinity PDF Merger?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, unlike other tools, we process files inside your browser. Your documents are never uploaded to any server, making it 100% secure for confidential data."
        }
      }, {
        "@type": "Question",
        "name": "Can I combine PDF files on Mobile?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Absolutely. This tool works perfectly on Android, iPhone, Tablet, and Desktop without installing any app."
        }
      }]
    }
  </script>

  {/* Load PDF-Lib */}
  <script is:inline src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

  {/* üü¢ TOP AD */}
  <div class="mb-6">
    <AdSlot type="horizontal" />
  </div>

  <div class="space-y-8">
      
      {/* üéØ CHANGE 2: H1 Heading seedha "Merge PDF Files" */}
      <div class="text-center">
        <h1 class="text-3xl md:text-5xl font-extrabold text-gray-900 mb-2">
           Merge <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-600 to-pink-600">PDF Files</span> Online
        </h1>
        <p class="text-gray-500 text-lg">Combine multiple PDFs into one unified document.</p>
      </div>

      {/* STEP 1: UPLOAD */}
      <div id="uploadArea" class="py-12 text-center bg-white border-4 border-dashed border-red-200 rounded-3xl cursor-pointer hover:border-red-400 hover:shadow-lg transition relative group" onclick="document.getElementById('fileInput').click()">
          <div class="relative z-10">
            <div class="text-7xl mb-4 group-hover:scale-110 transition duration-200 drop-shadow-sm">üìë</div>
            <h3 class="text-3xl font-extrabold text-gray-800 mb-2">Select PDF Files</h3>
            <p class="text-gray-500 mb-8 font-medium text-lg">or Drag and Drop files here</p>
            
            <span class="bg-red-600 text-white px-10 py-4 rounded-xl font-bold text-lg shadow-xl hover:bg-red-700 transition flex items-center justify-center gap-2 w-max mx-auto">
                <span>üìÇ</span> Choose Files
            </span>
            <p class="mt-6 text-xs text-gray-400 font-bold uppercase tracking-wider">
                <span class="bg-red-50 text-red-600 px-2 py-1 rounded">üîí Secure</span> ‚Ä¢ 
                <span class="bg-blue-50 text-blue-600 px-2 py-1 rounded ml-2">‚ö° Unlimited</span>
            </p>
          </div>
          <input type="file" id="fileInput" multiple accept=".pdf" class="hidden" />
      </div>

      {/* STEP 2: FILE LIST (Hidden initially) */}
      <div id="fileListArea" class="hidden animate-fade-in">
          
          <div class="flex justify-between items-center mb-4 px-2">
              <h4 class="font-bold text-gray-800 text-lg">Files to Merge (<span id="count" class="text-red-600">0</span>)</h4>
              <button id="clearBtn" class="text-sm text-red-600 font-bold hover:bg-red-50 px-3 py-1 rounded transition">
                  üóëÔ∏è Clear All
              </button>
          </div>

          {/* List Container */}
          <div id="pdfList" class="space-y-3 mb-8">
              {/* Items injected via JS */}
          </div>

          {/* Merge Button */}
          <button id="mergeBtn" class="w-full bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white font-bold py-5 rounded-2xl shadow-lg hover:shadow-2xl hover:-translate-y-1 transition text-xl flex justify-center items-center gap-3">
              <span>üöÄ</span> Merge PDF Now
          </button>
      </div>

  </div>

  {/* üéØ CHANGE 3: Content ab "General Use" par focus karega */}
  <div slot="content">
      <p class="lead text-lg text-gray-700 mb-6">
          <strong>Infinity PDF Merger</strong> is the simplest and fastest tool to combine PDF files online. Whether you need to merge business reports, legal documents, invoices, or educational certificates, our tool does it securely in your browser.
      </p>

      {/* Features Grid */}
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 my-8 not-prose">
          <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition">
              <h3 class="text-xl mb-2">üîí Secure Merging</h3>
              <p class="text-gray-600 text-sm">Your files are processed locally on your device. No data is uploaded to our server, ensuring 100% privacy.</p>
          </div>
          <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition">
              <h3 class="text-xl mb-2">‚ö° Lightning Fast</h3>
              <p class="text-gray-600 text-sm">No upload/download waiting time. Merging happens instantly using your browser's power.</p>
          </div>
          <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition">
              <h3 class="text-xl mb-2">üì± Device Friendly</h3>
              <p class="text-gray-600 text-sm">Works flawlessly on Windows, Mac, Android, and iOS. No software installation needed.</p>
          </div>
      </div>

      <h3 class="font-bold text-gray-800 text-xl">How to combine PDF files?</h3>
      <ol class="list-decimal pl-5 space-y-3 text-gray-700">
          <li><strong>Select Files:</strong> Upload the PDF documents you want to join. You can select multiple files at once.</li>
          <li><strong>Review:</strong> Check the list of uploaded files. Remove any unwanted document.</li>
          <li><strong>Merge:</strong> Click on the "Merge PDF Now" button.</li>
          <li><strong>Download:</strong> Your unified PDF file will be ready for download instantly.</li>
      </ol>

      <div class="mt-8 bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-400">
          <p class="text-sm text-yellow-800">
              <strong>Tip:</strong> This tool is also perfect for students applying for <strong>UPSC, SSC, and Banking exams</strong> who need to merge marksheet and certificate photos into a single PDF.
          </p>
      </div>
  </div>

</ToolLayout>

{/* üß† LOGIC (Same robust code) */}
<script>
  // @ts-nocheck
  const fileInput = document.getElementById('fileInput');
  const uploadArea = document.getElementById('uploadArea');
  const fileListArea = document.getElementById('fileListArea');
  const pdfList = document.getElementById('pdfList');
  const countSpan = document.getElementById('count');
  const clearBtn = document.getElementById('clearBtn');
  const mergeBtn = document.getElementById('mergeBtn');

  let selectedFiles = [];

  fileInput?.addEventListener('change', (e) => {
      if (e.target.files && e.target.files.length > 0) {
          const newFiles = Array.from(e.target.files).filter(f => f.type === 'application/pdf');
          if(newFiles.length === 0) {
              alert("Please select valid PDF files only!");
              return;
          }
          selectedFiles = [...selectedFiles, ...newFiles];
          updateUI();
      }
  });

  function updateUI() {
      if (selectedFiles.length > 0) {
          uploadArea.classList.add('hidden');
          fileListArea.classList.remove('hidden');
      } else {
          uploadArea.classList.remove('hidden');
          fileListArea.classList.add('hidden');
      }

      countSpan.innerText = selectedFiles.length;
      pdfList.innerHTML = '';

      selectedFiles.forEach((file, index) => {
          const div = document.createElement('div');
          div.className = 'flex items-center justify-between bg-white p-4 rounded-xl border border-gray-200 shadow-sm transition hover:shadow-md';
          div.innerHTML = `
              <div class="flex items-center gap-4 overflow-hidden">
                  <div class="w-10 h-10 bg-red-50 text-red-600 rounded-lg flex items-center justify-center text-xl font-bold">
                      ${index + 1}
                  </div>
                  <div class="min-w-0">
                      <p class="text-sm font-bold text-gray-800 truncate">${file.name}</p>
                      <p class="text-xs text-gray-500 font-mono">${(file.size / 1024).toFixed(0)} KB</p>
                  </div>
              </div>
              <button onclick="window.removePdf(${index})" class="w-8 h-8 flex items-center justify-center rounded-full text-gray-400 hover:bg-red-100 hover:text-red-600 transition" title="Remove">‚úï</button>
          `;
          pdfList.appendChild(div);
      });
  }

  window.removePdf = (index) => {
      selectedFiles.splice(index, 1);
      updateUI();
  };

  clearBtn?.addEventListener('click', () => {
      selectedFiles = [];
      fileInput.value = '';
      updateUI();
  });

  mergeBtn?.addEventListener('click', async () => {
      if (selectedFiles.length < 2) {
          alert("Please select at least 2 PDF files to merge.");
          return;
      }

      const originalText = mergeBtn.innerHTML;
      mergeBtn.innerHTML = "Processing... ‚è≥";
      mergeBtn.disabled = true;
      mergeBtn.classList.add('opacity-75', 'cursor-not-allowed');

      try {
          const { PDFDocument } = PDFLib;
          const mergedPdf = await PDFDocument.create();

          for (const file of selectedFiles) {
              const arrayBuffer = await file.arrayBuffer();
              const pdf = await PDFDocument.load(arrayBuffer);
              const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
              copiedPages.forEach((page) => mergedPdf.addPage(page));
          }

          const pdfBytes = await mergedPdf.save();
          const blob = new Blob([pdfBytes], { type: 'application/pdf' });
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = `Merged-File-${Date.now()}.pdf`;
          link.click();

          mergeBtn.innerHTML = "üéâ Merged Successfully!";
      } catch (error) {
          console.error(error);
          alert("Error merging PDFs. Encrypted files not supported.");
          mergeBtn.innerHTML = "Try Again ‚ùå";
      } finally {
          setTimeout(() => {
              mergeBtn.innerHTML = originalText;
              mergeBtn.disabled = false;
              mergeBtn.classList.remove('opacity-75', 'cursor-not-allowed');
          }, 3000);
      }
  });
</script>

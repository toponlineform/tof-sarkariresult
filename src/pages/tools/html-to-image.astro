---
// src/pages/tools/html-to-image.astro
import Layout from '../../layouts/Layout.astro';
---

<Layout title="HTML to Image Converter - Free Developer Tool">
  
  <main class="tool-wrapper">
    <div class="header-center">
      <h1>âš¡ HTML to Image Converter</h1>
      <p>Paste your HTML & CSS code below and download the high-quality image instantly.</p>
    </div>

    <div class="editor-container">
      
      <div class="input-panel">
        
        <div class="code-box">
          <label class="label-tag html-tag">HTML</label>
          <textarea id="htmlInput" placeholder="<div>Hello World</div>"></textarea>
        </div>

        <div class="code-box">
          <label class="label-tag css-tag">CSS</label>
          <textarea id="cssInput" placeholder=".box { color: red; font-size: 20px; }"></textarea>
        </div>

        <div class="control-bar">
          <div class="bg-control">
            <span>Background:</span>
            <input type="color" id="bgColorPicker" value="#ffffff">
            <label><input type="checkbox" id="transparentBg"> Transparent</label>
          </div>
          <button id="downloadBtn" class="action-btn">ðŸ“¸ Download PNG</button>
        </div>

      </div>

      <div class="preview-panel">
        <label class="preview-label">Live Preview</label>
        
        <div class="canvas-wrapper">
          <div id="renderTarget" class="render-box">
            <div class="placeholder-text">Preview will appear here...</div>
          </div>
        </div>
      </div>

    </div>
  </main>
</Layout>

<script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script is:inline>
  // Elements
  const htmlInput = document.getElementById('htmlInput');
  const cssInput = document.getElementById('cssInput');
  const renderTarget = document.getElementById('renderTarget');
  const downloadBtn = document.getElementById('downloadBtn');
  const bgColorPicker = document.getElementById('bgColorPicker');
  const transparentBg = document.getElementById('transparentBg');

  // Default Content
  const defaultHTML = `<div class="card">
  <h2>ðŸš€ Top Online Form</h2>
  <p>HTML to Image Generator</p>
  <button>Download Now</button>
</div>`;

  const defaultCSS = `.card {
  background: linear-gradient(135deg, #dc2626, #991b1b);
  color: white;
  padding: 40px;
  border-radius: 20px;
  text-align: center;
  font-family: sans-serif;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  width: 300px;
}
h2 { margin: 0 0 10px 0; font-size: 24px; }
button {
  background: #facc15;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  font-weight: bold;
  cursor: pointer;
  margin-top: 20px;
}`;

  // Initialize
  htmlInput.value = defaultHTML;
  cssInput.value = defaultCSS;
  updatePreview();

  // Listeners
  htmlInput.addEventListener('input', updatePreview);
  cssInput.addEventListener('input', updatePreview);
  
  bgColorPicker.addEventListener('input', () => {
    if(!transparentBg.checked) renderTarget.style.backgroundColor = bgColorPicker.value;
  });

  transparentBg.addEventListener('change', () => {
    if(transparentBg.checked) {
      renderTarget.style.backgroundColor = 'transparent';
    } else {
      renderTarget.style.backgroundColor = bgColorPicker.value;
    }
  });

  // Function to Update Live Preview
  function updatePreview() {
    const html = htmlInput.value;
    const css = `<style>${cssInput.value}</style>`;
    renderTarget.innerHTML = css + html;
  }

  // Function to Download
  downloadBtn.addEventListener('click', () => {
    const originalText = downloadBtn.innerText;
    downloadBtn.innerText = "Processing... âš™ï¸";
    
    // Check transparency
    let bg = transparentBg.checked ? null : bgColorPicker.value;

    html2canvas(renderTarget, {
      backgroundColor: bg,
      scale: 2, // High Res
      logging: false
    }).then(canvas => {
      const link = document.createElement('a');
      link.download = 'generated-image.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
      downloadBtn.innerText = "âœ… Saved!";
      setTimeout(() => downloadBtn.innerText = originalText, 2000);
    });
  });
</script>

<style>
  /* --- LAYOUT --- */
  .tool-wrapper {
    max-width: 1200px; margin: 0 auto; padding: 40px 20px;
    font-family: 'Segoe UI', sans-serif; color: white;
  }
  .header-center { text-align: center; margin-bottom: 40px; }
  .header-center h1 { color: #facc15; margin-bottom: 10px; font-size: 2.5rem; }
  .header-center p { color: #ccc; }

  /* --- EDITOR GRID --- */
  .editor-container {
    display: grid; grid-template-columns: 1fr 1fr; gap: 40px;
  }
  
  /* Responsive for Mobile */
  @media (max-width: 768px) {
    .editor-container { grid-template-columns: 1fr; }
  }

  /* --- INPUT PANEL --- */
  .input-panel { display: flex; flex-direction: column; gap: 20px; }
  
  .code-box { position: relative; }
  .label-tag {
    position: absolute; top: 0; right: 0;
    padding: 4px 10px; font-size: 12px; font-weight: bold;
    border-bottom-left-radius: 8px;
  }
  .html-tag { background: #e34c26; color: white; }
  .css-tag { background: #264de4; color: white; }

  textarea {
    width: 100%; height: 200px;
    background: #1e1e1e; color: #a9b7c6;
    border: 1px solid #444; border-radius: 8px;
    padding: 15px; font-family: monospace; font-size: 14px;
    resize: vertical; outline: none;
  }
  textarea:focus { border-color: #facc15; }

  /* --- CONTROLS --- */
  .control-bar {
    background: #222; padding: 15px; border-radius: 10px;
    display: flex; justify-content: space-between; align-items: center;
    border: 1px solid #333;
  }
  .bg-control { display: flex; align-items: center; gap: 10px; font-size: 14px; }
  input[type="color"] { border: none; width: 30px; height: 30px; cursor: pointer; background: none; }
  
  .action-btn {
    background: #dc2626; color: white; border: none;
    padding: 10px 25px; border-radius: 5px; font-weight: bold; cursor: pointer;
    transition: 0.2s;
  }
  .action-btn:hover { background: #b91c1c; }

  /* --- PREVIEW PANEL --- */
  .preview-panel {
    background: #111; border: 1px solid #333;
    border-radius: 12px; padding: 20px;
    display: flex; flex-direction: column;
  }
  .preview-label { color: #888; font-size: 12px; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 1px; }

  .canvas-wrapper {
    flex-grow: 1;
    background-image: radial-gradient(#333 1px, transparent 1px);
    background-size: 20px 20px; background-color: #000;
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    padding: 40px; overflow: auto; min-height: 400px;
  }

  .render-box {
    /* This box will grow based on content */
    background-color: white; /* Default bg */
    display: inline-block;
  }
</style>

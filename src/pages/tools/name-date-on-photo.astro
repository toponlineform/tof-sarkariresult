---
import Layout from '../../layouts/Layout.astro';
import AdSlot from '../../components/AdSlot.astro';

const title = "Add Name and Date on Photo Online - For SSC & Govt Exams";
const description = "Instantly add Name and Date of Photo (DOP) on your passport size photograph. Required for SSC CGL, CHSL, MTS, and Railway Application Forms.";
---

<Layout title={title} description={description}>
  
  <div class="max-w-6xl mx-auto px-4 py-8">
      
      {/* HEADER */}
      <div class="text-center mb-8">
          <span class="bg-blue-100 text-blue-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">SSC Special</span>
          <h1 class="text-3xl md:text-5xl font-extrabold text-gray-900 mt-3 mb-4">
              Name & Date on <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-500">Photo</span>
          </h1>
          <p class="text-gray-500 text-lg max-w-2xl mx-auto">
              Add your <strong>Name</strong> and <strong>Date of Photo (DOP)</strong> at the bottom of your passport photo as per SSC/Govt rules.
          </p>
      </div>

      {/* üü¢ TOP AD */}
      <div class="mb-8">
        <AdSlot type="horizontal" />
      </div>

      {/* MAIN TOOL AREA */}
      <div class="bg-white border border-gray-200 rounded-2xl shadow-xl overflow-hidden p-6 md:p-10">
          
          <div class="flex flex-col lg:flex-row gap-10 items-start">
              
              {/* LEFT: CONTROLS */}
              <div class="w-full lg:w-1/2 flex flex-col gap-6">
                  
                  {/* Step 1: Upload */}
                  <div class="bg-blue-50 p-5 rounded-xl border border-blue-100">
                      <label class="block text-sm font-bold text-gray-700 mb-2">1. Upload Passport Photo</label>
                      <input type="file" id="fileInput" accept="image/*" class="w-full p-2 bg-white border border-gray-300 rounded-lg text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer">
                  </div>

                  {/* Step 2: Enter Details */}
                  <div class="bg-gray-50 p-5 rounded-xl border border-gray-200 space-y-4">
                      <h3 class="font-bold text-gray-800 text-sm">2. Enter Details</h3>
                      
                      <div>
                          <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Your Name</label>
                          <input type="text" id="nameInput" placeholder="e.g. RAHUL KUMAR" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none uppercase font-bold text-gray-800">
                      </div>

                      <div>
                          <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Date of Photo (DOP)</label>
                          <input type="date" id="dateInput" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-bold text-gray-800">
                      </div>

                      <div class="flex items-center gap-2 mt-2">
                          <input type="checkbox" id="showDopPrefix" class="w-4 h-4 text-blue-600 rounded" checked>
                          <label for="showDopPrefix" class="text-sm text-gray-600">Add "DOP:" prefix before date</label>
                      </div>
                  </div>

                  <button id="downloadBtn" class="w-full bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition transform hover:-translate-y-1 text-lg flex justify-center items-center gap-2 opacity-50 cursor-not-allowed" disabled>
                      ‚¨áÔ∏è Download Photo
                  </button>
              </div>

              {/* RIGHT: PREVIEW */}
              <div class="w-full lg:w-1/2 flex flex-col items-center">
                  <h3 class="font-bold text-gray-400 text-sm uppercase mb-4 tracking-widest">Live Preview</h3>
                  
                  {/* Canvas Container */}
                  <div class="relative shadow-2xl border-4 border-white bg-gray-200 rounded-lg overflow-hidden max-w-[350px]">
                      {/* Placeholder Text when no image */}
                      <div id="placeholder" class="w-[300px] h-[400px] flex flex-col items-center justify-center text-gray-400 gap-2">
                          <span class="text-4xl">üñºÔ∏è</span>
                          <span class="text-sm">Upload photo to see preview</span>
                      </div>
                      
                      {/* The Canvas */}
                      <canvas id="photoCanvas" class="hidden max-w-full h-auto"></canvas>
                  </div>

                  <p class="text-xs text-gray-400 mt-4 max-w-xs text-center">
                      * The name and date will be placed on a white strip at the bottom, covering about 20% of the image (As per SSC standards).
                  </p>
              </div>

          </div>
      </div>

      {/* üü¢ BOTTOM AD */}
      <div class="mt-8 mb-12">
        <AdSlot type="horizontal" />
      </div>

      {/* SEO CONTENT */}
      <div class="prose prose-blue max-w-none bg-white p-8 rounded-2xl border border-gray-100 shadow-sm">
          <h2 class="text-2xl font-bold text-gray-800">Why Add Date on Photo for SSC Exams?</h2>
          <p class="text-gray-600">
             The Staff Selection Commission (SSC) and Railway Recruitment Board (RRB) have a strict rule: <strong>The photograph must have the Date of Photograph (DOP) clearly printed on it.</strong>
          </p>
          <p class="text-gray-600">
             If you upload a photo without the date, your candidature can be cancelled. This tool helps you:
          </p>
          <ul class="list-disc pl-5 text-gray-700 space-y-1">
              <li>Add a white strip at the bottom automatically.</li>
              <li>Write your Name and Date in clear, bold, black letters.</li>
              <li>Maintain the quality of your original passport photo.</li>
          </ul>
      </div>

  </div>

  {/* üß† JAVASCRIPT LOGIC */}
  <script>
      const fileInput = document.getElementById('fileInput');
      const nameInput = document.getElementById('nameInput');
      const dateInput = document.getElementById('dateInput');
      const showDopPrefix = document.getElementById('showDopPrefix');
      const downloadBtn = document.getElementById('downloadBtn');
      
      const photoCanvas = document.getElementById('photoCanvas');
      const placeholder = document.getElementById('placeholder');
      const ctx = photoCanvas.getContext('2d');

      let originalImage = null;

      // Set default date to today
      dateInput.valueAsDate = new Date();

      // 1. Handle Image Upload
      fileInput.addEventListener('change', (e) => {
          if (e.target.files && e.target.files.length > 0) {
              const file = e.target.files[0];
              const reader = new FileReader();
              
              reader.onload = (event) => {
                  originalImage = new Image();
                  originalImage.onload = () => {
                      updateCanvas();
                      placeholder.classList.add('hidden');
                      photoCanvas.classList.remove('hidden');
                      downloadBtn.disabled = false;
                      downloadBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                  };
                  originalImage.src = event.target.result;
              };
              reader.readAsDataURL(file);
          }
      });

      // 2. Real-time Updates
      nameInput.addEventListener('input', updateCanvas);
      dateInput.addEventListener('input', updateCanvas);
      showDopPrefix.addEventListener('change', updateCanvas);

      // 3. Draw Logic
      function updateCanvas() {
          if (!originalImage) return;

          // Set Canvas Dimensions to match Image
          const w = originalImage.width;
          const h = originalImage.height;
          photoCanvas.width = w;
          photoCanvas.height = h;

          // Draw Original Image
          ctx.drawImage(originalImage, 0, 0);

          // Inputs
          const nameText = nameInput.value.toUpperCase();
          const rawDate = dateInput.value;
          let dateText = "";

          // Format Date to DD-MM-YYYY
          if(rawDate) {
              const [year, month, day] = rawDate.split('-');
              dateText = `${day}-${month}-${year}`;
              if (showDopPrefix.checked) {
                  dateText = "DOP: " + dateText;
              }
          }

          // --- DRAW WHITE STRIP AT BOTTOM ---
          // Height of strip = 15% to 20% of image height
          const stripHeight = h * 0.18; 
          const stripY = h - stripHeight;

          ctx.fillStyle = "#ffffff";
          ctx.fillRect(0, stripY, w, stripHeight);

          // --- DRAW TEXT ---
          ctx.fillStyle = "#000000";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";

          // Font sizing logic based on image width
          const fontSize = w * 0.08; // 8% of width
          ctx.font = `bold ${fontSize}px Arial`;

          const centerX = w / 2;
          
          if (nameText && dateText) {
              // Both Name and Date: Two Lines
              const line1Y = stripY + (stripHeight * 0.35);
              const line2Y = stripY + (stripHeight * 0.75);
              
              ctx.fillText(nameText, centerX, line1Y);
              ctx.fillText(dateText, centerX, line2Y);
          } else if (nameText || dateText) {
              // Single Line (Centered vertically in strip)
              const text = nameText || dateText;
              const centerY = stripY + (stripHeight / 2);
              ctx.fillText(text, centerX, centerY);
          }
      }

      // 4. Download
      downloadBtn.addEventListener('click', () => {
          if (!originalImage) return;
          const link = document.createElement('a');
          link.download = `Photo-with-Name-Date-${Date.now()}.jpg`;
          link.href = photoCanvas.toDataURL('image/jpeg', 1.0);
          link.click();
      });
  </script>
</Layout>

---
import ToolLayout from '../../layouts/ToolLayout.astro';
import AdSlot from '../../components/AdSlot.astro';

const title = "Passport Photo Maker - Create Printable Sheet (A4, 4x6, 5x7)";
const description = "Free Passport Photo Maker. Create 8, 15, or 36 passport size photos on 4x6, 5x7, or A4 paper. Download HD printable sheet for free.";
---

<ToolLayout 
  title={title} 
  description={description}
  toolName="Passport Photo Maker"
>

  {/* ‚ö° FAQ SCHEMA */}
  <script type="application/ld+json" slot="head">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "How to make passport size photo for printing?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Upload your photo, crop it to the correct aspect ratio using our tool, select the paper size (like 4x6 inch), and download the printable sheet."
        }
      }, {
        "@type": "Question",
        "name": "How many passport photos fit on 4x6 paper?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "A standard 4x6 inch photo paper can fit exactly 8 passport size photos (3.5cm x 4.5cm)."
        }
      }]
    }
  </script>

  {/* Load CropperJS */}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
  <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

  {/* üü¢ TOP AD */}
  <div class="mb-6">
    <AdSlot type="horizontal" />
  </div>

  <div class="space-y-8">
      
      {/* STEP 1: UPLOAD */}
      <div id="step1" class="py-12 text-center bg-indigo-50 border-4 border-dashed border-indigo-200 rounded-3xl cursor-pointer hover:bg-indigo-100 transition relative group" onclick="document.getElementById('fileInput').click()">
          <div class="relative z-10">
            <div class="text-7xl mb-4 group-hover:scale-110 transition duration-200 drop-shadow-sm">üì∏</div>
            <h3 class="text-3xl font-extrabold text-gray-800 mb-2">Create Passport Photos</h3>
            <p class="text-gray-500 mb-8 font-medium text-lg">Make Printable Sheet (A4 / 4x6)</p>
            
            <span class="bg-indigo-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-indigo-700 transition flex items-center justify-center gap-2 w-max mx-auto">
                <span>üìÇ</span> Upload Selfie/Photo
            </span>
          </div>
          <input type="file" id="fileInput" accept="image/*" class="hidden" />
      </div>

      {/* STEP 2: CROP & SETTINGS */}
      <div id="step2" class="hidden animate-fade-in">
          <div class="flex flex-col xl:flex-row gap-8">
              
              {/* Left: Cropper */}
              <div class="w-full xl:w-2/3 bg-gray-900 rounded-xl overflow-hidden shadow-2xl relative h-[500px]">
                  <img id="cropImage" class="max-w-full" />
                  <div class="absolute bottom-4 left-0 right-0 text-center pointer-events-none">
                      <span class="bg-black/50 text-white px-3 py-1 rounded-full text-xs backdrop-blur-md">Adjust selection to match face</span>
                  </div>
              </div>

              {/* Right: Controls */}
              <div class="w-full xl:w-1/3 space-y-6">
                  
                  {/* Paper Select */}
                  <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm">
                      <label class="block text-sm font-bold text-gray-700 mb-2">1. Choose Paper Size</label>
                      <select id="paperSelect" class="w-full p-3 border-2 border-indigo-100 rounded-lg bg-indigo-50 font-bold text-gray-800 focus:outline-none focus:border-indigo-500 transition cursor-pointer">
                          <option value="4x6">4 x 6 Inch (Standard)</option>
                          <option value="5x7">5 x 7 Inch (Medium)</option>
                          <option value="A4">A4 Size (Office Paper)</option>
                      </select>
                      <p id="paperInfo" class="text-xs text-indigo-600 mt-2 font-medium">‚ú® Fits 8 Photos (Cheapest Print)</p>
                  </div>

                  {/* Quantity Slider */}
                  <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm">
                      <div class="flex justify-between items-center mb-4">
                          <label class="block text-sm font-bold text-gray-700">2. Quantity</label>
                          <span class="bg-indigo-600 text-white px-3 py-1 rounded-lg font-bold text-sm" id="qtyDisplay">8 Photos</span>
                      </div>
                      <input type="range" id="qtyRange" min="1" max="8" value="8" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                      <div class="flex justify-between text-xs text-gray-400 mt-2">
                          <span>1 Copy</span>
                          <span id="maxQtyLabel">8 Copies</span>
                      </div>
                  </div>

                  {/* Action */}
                  <button id="generateBtn" class="w-full bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition transform hover:-translate-y-1 flex justify-center items-center gap-2 text-lg">
                      <span>‚öôÔ∏è</span> Generate Sheet
                  </button>
              </div>
          </div>
      </div>

      {/* STEP 3: PREVIEW & DOWNLOAD */}
      <div id="step3" class="hidden animate-fade-in text-center">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">Your Printable Sheet is Ready! üéâ</h3>
          
          <div class="inline-block border-8 border-gray-200 shadow-2xl bg-white rounded-lg overflow-hidden mb-8">
               <canvas id="photoCanvas" class="max-w-full h-auto max-h-[600px]"></canvas>
          </div>

          <div class="flex flex-col sm:flex-row gap-4 justify-center max-w-lg mx-auto">
              <button id="downloadBtn" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-xl shadow-lg text-lg flex justify-center items-center gap-2 transition animate-bounce-slow">
                  ‚¨áÔ∏è Download HD Image
              </button>
              <button onclick="location.reload()" class="flex-1 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-bold py-4 px-8 rounded-xl shadow-sm transition">
                  ‚Ü∫ Create Another
              </button>
          </div>
          <p class="text-sm text-gray-500 mt-4">Print this image on selected paper size without scaling (100% scale).</p>
      </div>

  </div>

  {/* SEO CONTENT */}
  <div slot="content">
      <p class="lead text-lg text-gray-700 mb-6">
          Save money on photography studios! Use the <strong>Infinity Passport Photo Maker</strong> to arrange your photos on standard 4x6 or A4 sheets and print them for a fraction of the cost.
      </p>

      {/* üåü SEO MAGIC TABLE */}
      <h3 class="text-xl font-bold text-gray-800 mb-4">Paper Sizes & Photo Capacity</h3>
      <div class="overflow-hidden rounded-xl border border-gray-200 mb-8 shadow-sm">
        <table class="min-w-full text-sm text-left bg-white">
            <thead class="bg-indigo-50 text-indigo-800 font-bold border-b">
                <tr>
                    <th class="p-4">Paper Size</th>
                    <th class="p-4">Dimensions (Inch)</th>
                    <th class="p-4">Max Photos (3.5x4.5cm)</th>
                    <th class="p-4">Best For</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                <tr>
                    <td class="p-4 font-bold">4x6 Inch</td>
                    <td class="p-4">4" x 6"</td>
                    <td class="p-4 text-green-600 font-bold">8 Photos</td>
                    <td class="p-4">Home Printers / Labs</td>
                </tr>
                <tr>
                    <td class="p-4 font-bold">5x7 Inch</td>
                    <td class="p-4">5" x 7"</td>
                    <td class="p-4 text-green-600 font-bold">15 Photos</td>
                    <td class="p-4">Medium Size</td>
                </tr>
                <tr>
                    <td class="p-4 font-bold">A4 Size</td>
                    <td class="p-4">8.3" x 11.7"</td>
                    <td class="p-4 text-green-600 font-bold">36 Photos</td>
                    <td class="p-4">Bulk Printing (Shop)</td>
                </tr>
            </tbody>
        </table>
      </div>

      <h3>How to print correctly?</h3>
      <ul class="list-disc pl-5 space-y-2 text-gray-700">
          <li>Download the HD Image from our tool.</li>
          <li>Go to a photo studio or use a high-quality color printer.</li>
          <li><strong>Important:</strong> When printing, select "Actual Size" or "Scale 100%". Do not select "Fit to Page" otherwise the photo size (3.5cm x 4.5cm) will shrink.</li>
      </ul>
  </div>

</ToolLayout>

{/* üß† LOGIC */}
<script>
  // @ts-nocheck
  const fileInput = document.getElementById('fileInput');
  const step1 = document.getElementById('step1');
  const step2 = document.getElementById('step2');
  const step3 = document.getElementById('step3');
  const cropImage = document.getElementById('cropImage');
  const paperSelect = document.getElementById('paperSelect');
  const paperInfo = document.getElementById('paperInfo');
  const qtyRange = document.getElementById('qtyRange');
  const qtyDisplay = document.getElementById('qtyDisplay');
  const maxQtyLabel = document.getElementById('maxQtyLabel');
  const generateBtn = document.getElementById('generateBtn');
  const photoCanvas = document.getElementById('photoCanvas');
  const downloadBtn = document.getElementById('downloadBtn');

  let cropper = null;

  // Configuration (300 DPI)
  const PAPERS = {
      '4x6': { w: 1200, h: 1800, max: 8, cols: 2, desc: "‚ú® Fits 8 Photos (Cheapest Print)" },
      '5x7': { w: 1500, h: 2100, max: 15, cols: 3, desc: "‚ú® Fits 15 Photos (Standard)" },
      'A4':  { w: 2480, h: 3508, max: 36, cols: 5, desc: "‚ú® Fits 36 Photos (Bulk)" }
  };

  // 1. Upload & Init Cropper
  fileInput?.addEventListener('change', (e) => {
      if (e.target.files && e.target.files.length > 0) {
          const file = e.target.files[0];
          cropImage.src = URL.createObjectURL(file);
          
          step1.classList.add('hidden');
          step2.classList.remove('hidden');

          if(cropper) cropper.destroy();
          cropper = new Cropper(cropImage, {
              aspectRatio: 3.5 / 4.5, // Standard Passport Ratio
              viewMode: 1,
              dragMode: 'move',
              autoCropArea: 0.85,
              guides: true,
              center: true,
              background: false,
          });
      }
  });

  // 2. Update Limits based on Paper
  paperSelect?.addEventListener('change', () => {
      const type = paperSelect.value;
      const config = PAPERS[type];
      
      // Update Range Max
      qtyRange.max = config.max;
      maxQtyLabel.innerText = `${config.max} Copies`;
      paperInfo.innerText = config.desc;

      // Reset value if out of bounds
      if(parseInt(qtyRange.value) > config.max) {
          qtyRange.value = config.max;
          qtyDisplay.innerText = `${config.max} Photos`;
      }
  });

  // 3. Update Quantity Text
  qtyRange?.addEventListener('input', (e) => {
      qtyDisplay.innerText = `${e.target.value} Photos`;
  });

  // 4. Generate Sheet
  generateBtn?.addEventListener('click', () => {
      if(!cropper) return;

      const type = paperSelect.value;
      const qty = parseInt(qtyRange.value);
      const config = PAPERS[type];

      // Get cropped image
      const croppedCanvas = cropper.getCroppedCanvas({
          width: 413, height: 531, // 3.5cm x 4.5cm @ 300 DPI
          imageSmoothingQuality: 'high'
      });

      // Setup output canvas
      photoCanvas.width = config.w;
      photoCanvas.height = config.h;
      const ctx = photoCanvas.getContext('2d');

      // Fill White Background
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0, 0, config.w, config.h);

      // Grid Calculation
      const pWidth = 413;
      const pHeight = 531;
      const gap = 30; // Gap for cutting
      const cols = config.cols;

      // Center calculation
      const totalContentW = (cols * pWidth) + ((cols - 1) * gap);
      const startX = (config.w - totalContentW) / 2;
      const startY = 100; // Top margin

      for (let i = 0; i < qty; i++) {
          const colIndex = i % cols;
          const rowIndex = Math.floor(i / cols);

          const x = startX + (colIndex * (pWidth + gap));
          const y = startY + (rowIndex * (pHeight + gap));

          // Draw Photo
          ctx.drawImage(croppedCanvas, x, y, pWidth, pHeight);
          
          // Draw Cutting Guide (Light Grey Border)
          ctx.strokeStyle = "#e5e7eb";
          ctx.lineWidth = 2;
          ctx.strokeRect(x, y, pWidth, pHeight);
      }

      step2.classList.add('hidden');
      step3.classList.remove('hidden');
      window.scrollTo(0, 0);
  });

  // 5. Download
  downloadBtn?.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = `Passport-Sheet-${Date.now()}.jpg`;
      link.href = photoCanvas.toDataURL('image/jpeg', 1.0); // Max Quality
      link.click();
  });
</script>
